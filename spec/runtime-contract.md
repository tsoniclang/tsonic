# Runtime Contract

## Purpose

Define runtime asset packaging and loading guarantees.

## Package Structure

```
Tsonic.Runtime/
├── Tsonic.Runtime.dll          # Main runtime assembly
├── lib/                         # .NET type declarations
│   ├── System.IO/
│   │   ├── index.d.ts          # TypeScript declarations
│   │   ├── metadata.json       # CLR metadata
│   │   └── bindings.json       # Name mappings
│   └── ...
└── README.md
```

## Runtime APIs

All runtime helpers are in `Tsonic.Runtime` namespace:

- **Global functions** - `parseInt`, `parseFloat`, `isNaN`, etc.
- **Array** - Static class with array helpers
- **String** - Static class with string helpers
- **Math** - Static class matching JavaScript Math
- **JSON** - Static class for parse/stringify
- **console** - Static class for logging
- **Operators** - `typeof`, `instanceof`

## Type Roots

The compiler looks for `.d.ts` files in:

1. `node_modules/@tsonic/runtime/lib/` - Bundled .NET declarations
2. Project-specific `lib/` - Custom .NET bindings

## Metadata Loading

When encountering .NET imports, the emitter:

1. Finds corresponding `.d.ts` file
2. Loads `metadata.json` for CLR-specific info
3. Loads `bindings.json` for name mappings
4. Uses this data for correct C# emission

## Version Compatibility

Runtime version must match compiler version:

```json
{
  "devDependencies": {
    "@tsonic/cli": "0.0.1",
    "@tsonic/runtime": "0.0.1" // Must match
  }
}
```

## Implementation

- Runtime C# code: `packages/runtime/src/` (separate repo)
- Type declarations: Generated by tsbindgen

## See Also

- [metadata.md](metadata.md) - Metadata schema
- [bindings.md](bindings.md) - Name mapping schema
- [docs/language/runtime.md](../docs/language/runtime.md) - User API guide
